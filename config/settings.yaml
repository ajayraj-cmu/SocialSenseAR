# ============================================================
# PERCEPTUAL MODULATION ENGINE - CONFIGURATION
# ============================================================
# All values here are sensory-safe defaults for neurodivergent users

system:
  name: "Perceptual Modulation Engine"
  version: "0.1.0"
  mode: "live"  # live | recording | playback
  
# ============================================================
# LATENCY BUDGETS (HARD CONSTRAINTS)
# ============================================================
latency:
  video_max_ms: 120  # Maximum end-to-end video latency
  audio_max_ms: 40   # Maximum end-to-end audio latency
  frame_budget_ms: 33  # Target ~30 FPS processing
  
# ============================================================
# VIDEO CAPTURE SETTINGS
# ============================================================
video:
  device_index: 0  # Quest 3 passthrough as webcam
  width: 1920
  height: 1080
  fps: 30
  buffer_frames: 3
  
# ============================================================
# AUDIO CAPTURE SETTINGS
# ============================================================
audio:
  device_index: null  # Auto-detect
  sample_rate: 48000
  channels: 1  # Mono - more compatible with most devices
  chunk_size: 1024
  buffer_seconds: 0.5

# ============================================================
# SEGMENTATION (SAM-3)
# ============================================================
segmentation:
  model_type: "sam2_hiera_large"  # sam2_hiera_tiny | sam2_hiera_small | sam2_hiera_base_plus | sam2_hiera_large
  checkpoint_path: "models/sam2_hiera_large.pt"
  confidence_threshold: 0.65  # Below this, do not modify object
  mask_smoothing_kernel: 5
  morphological_iterations: 2
  cache_ttl_frames: 5

# ============================================================
# OBJECT TRACKING
# ============================================================
tracking:
  max_disappeared_frames: 30  # Frames before ID reassignment
  min_confidence_for_track: 0.5
  iou_threshold: 0.3
  kalman_process_noise: 0.01
  kalman_measurement_noise: 0.1

# ============================================================
# DEPTH ESTIMATION
# ============================================================
depth:
  use_hardware: false  # Quest 3 depth sensor if available
  fallback_model: "midas_v3.1_large"  # MiDaS fallback
  checkpoint_path: "models/midas_v31_large.pt"
  
# ============================================================
# AUDIO-VISUAL BINDING
# ============================================================
audio_visual:
  binding_confidence_threshold: 0.6
  spatial_resolution_degrees: 15  # Angular resolution for binding
  fallback_to_spatial: true  # Use spatial attenuation if binding fails
  ambient_preservation_ratio: 0.15  # Never fully isolate

# ============================================================
# SAFETY CONSTRAINTS (NEURODIVERGENT GUARDRAILS)
# ============================================================
safety:
  # Maximum parameter change rates
  max_brightness_delta_per_second: 0.15  # 15% max change/sec
  max_volume_delta_per_second: 0.2       # 20% max change/sec
  max_saturation_delta_per_second: 0.15
  max_blur_delta_per_second: 5.0         # px/sec
  
  # Minimum transition durations
  min_transition_seconds: 0.3
  default_transition_seconds: 0.5
  max_transition_seconds: 3.0
  
  # Absolute limits
  min_brightness: 0.1       # Never go fully dark
  max_brightness: 1.0
  min_volume: 0.05          # Never go fully silent
  max_blur_radius: 30       # px
  
  # Sensory load management
  enable_sensory_load_tracking: true
  sensory_load_threshold: 0.7  # Trigger dampening above this
  auto_dampen_secondary: true

# ============================================================
# VISUAL TRANSFORMATIONS
# ============================================================
visual_transforms:
  # Allowed operations
  allowed:
    - brightness_attenuation
    - color_temperature_shift
    - saturation_reduction
    - texture_simplification
    - edge_preserving_blur
    
  # Disallowed by default (can be explicitly enabled)
  disallowed:
    - object_removal
    - geometry_distortion
    - flashing_effects
    - high_contrast_overlay
    
  # Edge-preserving blur settings
  blur:
    type: "bilateral"  # bilateral | guided
    sigma_color: 75
    sigma_space: 75

# ============================================================
# AUDIO TRANSFORMATIONS
# ============================================================
audio_transforms:
  allowed:
    - selective_muting
    - volume_attenuation
    - frequency_filtering
    - directional_dampening
    
  # Frequency filtering presets
  frequency_presets:
    reduce_harsh:
      type: "lowpass"
      cutoff_hz: 4000
    reduce_bass:
      type: "highpass"
      cutoff_hz: 200
    reduce_mids:
      type: "bandstop"
      low_hz: 1000
      high_hz: 3000

# ============================================================
# INTENT PARSING
# ============================================================
intent:
  language_model: "spacy"  # spacy | local_llm
  spacy_model: "en_core_web_sm"
  require_confirmation_for_unsafe: true
  max_targets_per_command: 5

# ============================================================
# RECORDING MODE
# ============================================================
recording:
  output_dir: "recordings"
  format: "mp4"
  audio_format: "wav"
  max_duration_seconds: 300  # 5 minutes max
  
# ============================================================
# KEYBOARD BINDINGS
# ============================================================
keybindings:
  toggle_recording: "r"
  process_recording: "p"
  emergency_revert: "escape"
  increase_brightness: "up"
  decrease_brightness: "down"
  toggle_audio_mute: "m"

# ============================================================
# LOGGING
# ============================================================
logging:
  level: "INFO"  # DEBUG | INFO | WARNING | ERROR
  file: "logs/perceptual_engine.log"
  rotation: "10 MB"
  retention: "7 days"
  format: "{time:YYYY-MM-DD HH:mm:ss.SSS} | {level: <8} | {module}:{line} | {message}"


